<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MayaSecurity.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">tase</a> &gt; <a href="index.source.html" class="el_package">com.maya</a> &gt; <span class="el_source">MayaSecurity.java</span></div><h1>MayaSecurity.java</h1><pre class="source lang-java linenums">package com.maya;

import java.time.LocalDate;
import java.util.logging.*;

import com.google.gson.Gson;
import com.google.gson.reflect.TypeToken;
import java.lang.reflect.Type;

import com.maya.utils.Utils.Language;
import com.maya.requestclasses.MayaAllSecuritiesRequest;
import com.maya.requestclasses.MayaSecurityDataRequest;
import com.maya.requestclasses.MayaSecurityHistoricalRequest;
import com.maya.jsondata.SecurityHistory;
import com.maya.jsondata.SecurityListing;
import com.maya.utils.GSONUtil;

import java.util.Map;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;


public class MayaSecurity extends MayaBase {

    private static final int TYPE = 8;
    private static final int RECORDS = 1;
<span class="fc" id="L28">    private Type SecurityListingType = new TypeToken &lt;SecurityListing&gt;(){}.getType();</span>


    public MayaSecurity(Logger logger, int num_of_attempts, boolean verify) {
<span class="fc" id="L32">        super(logger, num_of_attempts, verify);</span>
<span class="fc" id="L33">    }</span>

    public List&lt;SecurityListing&gt; getAllSecurities(Language lang) throws Exception {
<span class="fc" id="L36">        this.logger.fine(&quot;MayaSecurity::getAllSecurities - before SendRequest&quot;);</span>
<span class="fc" id="L37">        String response =  sendRequest(new MayaAllSecuritiesRequest(lang));</span>
<span class="fc" id="L38">        this.logger.fine(&quot;MayaSecurity::getAllSecurities - after SendRequest&quot;);</span>
<span class="fc" id="L39">        return this.ResponseToSecurityList(response);</span>
    }

    public List&lt;SecurityListing&gt; ResponseToSecurityList(String response) {
<span class="fc" id="L43">        Gson gson = new Gson();</span>
<span class="fc" id="L44">        Type SecurityListingType = new TypeToken &lt;List&lt;SecurityListing&gt;&gt;() {}.getType();</span>
<span class="fc" id="L45">        List&lt;SecurityListing&gt; list = gson.fromJson(response, SecurityListingType);</span>
        
<span class="fc" id="L47">        Iterator&lt;SecurityListing&gt; securityListingIterator = list.iterator();</span>
        // while (securityListingIterator.hasNext()) {
        //     SecurityListing listing = securityListingIterator.next();
        //     this.logger.fine(listing.toString());
        // }
<span class="fc" id="L52">        return list;</span>
        
    }


    public  Map&lt;String, String&gt; getNames(
            SecurityListing englishDetails,SecurityListing hebrewDetails) {

<span class="fc" id="L60">        Map&lt;String, String&gt; names = new HashMap&lt;&gt;();</span>
<span class="fc" id="L61">        names.getOrDefault(names, null);</span>
<span class="fc" id="L62">        names.put(&quot;english_short_name&quot;, (String) englishDetails.Name);</span>
<span class="fc" id="L63">        names.put(&quot;english_long_name&quot;,(String) englishDetails.getOrDefault(&quot;LongName&quot;, englishDetails.SecurityLongName));</span>

<span class="fc" id="L65">        names.put(&quot;hebrew_short_name&quot;, (String) hebrewDetails.Name);</span>
<span class="fc" id="L66">        names.put(&quot;hebrew_long_name&quot;,(String) hebrewDetails.getOrDefault(&quot;LongName&quot;, hebrewDetails.SecurityLongName));</span>
<span class="fc" id="L67">        return names;</span>
    }

    public SecurityListing getDetails(String securityId, Language lang) throws Exception {
        // return sendRequest(new MayaSecurityDataRequest(securityId, lang));
<span class="fc" id="L72">        String responseString =  sendRequest(new MayaSecurityDataRequest(securityId, lang));</span>
<span class="fc" id="L73">        this.logger.fine(&quot;MayaSecurity::getDetails - responseString &quot;+ responseString);</span>
<span class="fc" id="L74">        Gson gson = new Gson();</span>
<span class="fc" id="L75">        SecurityListing securityListing  = gson.fromJson(responseString, this.SecurityListingType);</span>
        // this.logger.fine(&quot;MayaSecurity::getDetails - securityListing Id: &quot;+ securityListing.Id + &quot; Name: &quot;+ securityListing.Name);

<span class="fc" id="L78">        return securityListing;</span>
    }

    public SecurityHistory getPriceHistoryChunk(
            String securityId, LocalDate fromDate, LocalDate toDate, int page, Language lang) throws Exception {
<span class="nc bnc" id="L83" title="All 2 branches missed.">        int _page = (page == 0) ? 1 : page ;</span>
<span class="nc" id="L84">        this.logger.fine(&quot;MayaSecurity::getPriceHistoryChunk&quot;);</span>
<span class="nc" id="L85">        String responseString =  sendRequest(new MayaSecurityHistoricalRequest(securityId, fromDate, toDate, _page, TYPE, RECORDS, lang));</span>
<span class="nc" id="L86">        Gson gson = GSONUtil.createGson();</span>
<span class="nc" id="L87">        SecurityHistory historyListing = gson.fromJson(responseString, SecurityHistory.class);</span>
<span class="nc" id="L88">        return historyListing;</span>
    }

    public SecurityHistory getPriceHistory(
            String securityId, LocalDate fromDate, LocalDate toDate, int page, Language lang) throws Exception {
<span class="nc bnc" id="L93" title="All 2 branches missed.">        if (toDate == null) {</span>
<span class="nc" id="L94">            toDate = LocalDate.now();</span>
        }
<span class="nc bnc" id="L96" title="All 2 branches missed.">        if (fromDate == null) {</span>
<span class="nc" id="L97">            fromDate = toDate.minusDays(1);</span>
        }
<span class="nc" id="L99">        return getPriceHistoryChunk(securityId, fromDate, toDate, page, lang);</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>